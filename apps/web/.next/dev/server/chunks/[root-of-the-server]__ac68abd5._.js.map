{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/WADEOW/PROYECTOS/LibroWeb/codigoLibroWeb/apps/web/app/api/payment/route.js"],"sourcesContent":["import { MercadoPagoConfig, Preference } from 'mercadopago';\n\n// Configurar cliente de Mercado Pago\nconst client = new MercadoPagoConfig({\n  accessToken: process.env.MERCADO_PAGO_ACCESS_TOKEN,\n});\n\nexport async function POST(request) {\n  try {\n    const { physical, digital, total, orderId } = await request.json();\n\n    // Validar que haya productos\n    if (!orderId || (physical === 0 && digital === 0)) {\n      return Response.json(\n        { error: 'Datos de orden inválidos' },\n        { status: 400 }\n      );\n    }\n\n    // Crear items para la preferencia\n    const items = [];\n    \n    if (physical > 0) {\n      items.push({\n        id: 'book-physical',\n        title: 'Libro Físico',\n        description: `${physical} unidad(es) - Envío incluido`,\n        quantity: physical,\n        currency_id: 'MXN',\n        unit_price: 20\n      });\n    }\n\n    if (digital > 0) {\n      items.push({\n        id: 'book-digital',\n        title: 'Libro Digital',\n        description: `${digital} unidad(es) - Descarga inmediata`,\n        quantity: digital,\n        currency_id: 'MXN',\n        unit_price: 10\n      });\n    }\n\n    // Crear la preferencia de pago usando el SDK\n    const preference = new Preference(client);\n    \n    const body = {\n      items: items,\n      back_urls: {\n        success: `${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/checkout/redirect?type=success&orderId=${orderId}`,\n        failure: `${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/checkout/redirect?type=failure&orderId=${orderId}`,\n        pending: `${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/checkout/redirect?type=pending&orderId=${orderId}`\n      },\n      notification_url: `${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/api/payment/webhook`,\n      external_reference: orderId,\n      statement_descriptor: 'LibroWeb',\n      binary_mode: true\n    };\n\n    const response = await preference.create({ body });\n\n    console.log('✅ Preferencia creada:', response.id);\n    \n    return Response.json({\n      id: response.id,\n      init_point: response.init_point,\n      sandbox_init_point: response.sandbox_init_point\n    });\n  } catch (error) {\n    console.error('❌ Error al crear preferencia:', error.message);\n    console.error('Detalles:', error);\n    \n    return Response.json(\n      { \n        error: error.message || 'Error al procesar el pago',\n        details: error.response?.data || {}\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,qCAAqC;AACrC,MAAM,SAAS,IAAI,mKAAiB,CAAC;IACnC,aAAa,QAAQ,GAAG,CAAC,yBAAyB;AACpD;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEhE,6BAA6B;QAC7B,IAAI,CAAC,WAAY,aAAa,KAAK,YAAY,GAAI;YACjD,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAA2B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,kCAAkC;QAClC,MAAM,QAAQ,EAAE;QAEhB,IAAI,WAAW,GAAG;YAChB,MAAM,IAAI,CAAC;gBACT,IAAI;gBACJ,OAAO;gBACP,aAAa,GAAG,SAAS,4BAA4B,CAAC;gBACtD,UAAU;gBACV,aAAa;gBACb,YAAY;YACd;QACF;QAEA,IAAI,UAAU,GAAG;YACf,MAAM,IAAI,CAAC;gBACT,IAAI;gBACJ,OAAO;gBACP,aAAa,GAAG,QAAQ,gCAAgC,CAAC;gBACzD,UAAU;gBACV,aAAa;gBACb,YAAY;YACd;QACF;QAEA,6CAA6C;QAC7C,MAAM,aAAa,IAAI,4JAAU,CAAC;QAElC,MAAM,OAAO;YACX,OAAO;YACP,WAAW;gBACT,SAAS,GAAG,6DAAmC,wBAAwB,wCAAwC,EAAE,SAAS;gBAC1H,SAAS,GAAG,6DAAmC,wBAAwB,wCAAwC,EAAE,SAAS;gBAC1H,SAAS,GAAG,6DAAmC,wBAAwB,wCAAwC,EAAE,SAAS;YAC5H;YACA,kBAAkB,GAAG,6DAAmC,wBAAwB,oBAAoB,CAAC;YACrG,oBAAoB;YACpB,sBAAsB;YACtB,aAAa;QACf;QAEA,MAAM,WAAW,MAAM,WAAW,MAAM,CAAC;YAAE;QAAK;QAEhD,QAAQ,GAAG,CAAC,yBAAyB,SAAS,EAAE;QAEhD,OAAO,SAAS,IAAI,CAAC;YACnB,IAAI,SAAS,EAAE;YACf,YAAY,SAAS,UAAU;YAC/B,oBAAoB,SAAS,kBAAkB;QACjD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC,MAAM,OAAO;QAC5D,QAAQ,KAAK,CAAC,aAAa;QAE3B,OAAO,SAAS,IAAI,CAClB;YACE,OAAO,MAAM,OAAO,IAAI;YACxB,SAAS,MAAM,QAAQ,EAAE,QAAQ,CAAC;QACpC,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}